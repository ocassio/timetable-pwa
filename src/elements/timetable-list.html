<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">

<dom-module id="timetable-list">

  <template>

  <style include="iron-flex iron-flex-alignment">
    .container {
      padding: 16px;
      margin: auto;
    }
    @media screen and (min-width: 632px) {
      .container {
        width: 600px;
      }
    }
    .card-wrapper + .card-wrapper{
      padding-top: 16px;
    }
    paper-card {
      width: 100%;
    }
    paper-toolbar {
      --paper-toolbar-title: {
        margin-left: 0;
      }
    }
    .day-of-week {
      @apply(--paper-font-common-base);
    }
    .lesson + .lesson {
      margin-top: 16px;
    }
    .lesson span {
      line-height: 1.4;
    }
    .number {
      @apply(--paper-font-common-base);
      font-size: 24px;
    }
    .time {
      @apply(--paper-font-common-base);
      font-size: 12px;
      color: var(--light-theme-secondary-color);
    }
    .padding-right {
      padding-right: 16px;
    }
    .name {
      @apply(--paper-font-common-base);
      font-size: 16px;
    }
    .secondary {
      @apply(--paper-font-common-base);
      font-size: 14px;
      color: var(--light-theme-secondary-color);
    }
  </style>

  <div class="container fit vertical layout">
    <template is="dom-repeat" items="[[items]]" as="day">
      <div class="card-wrapper">
        <paper-card>
          <paper-toolbar>
            <span class="title">[[day.dayOfWeek]]</span>
            <span class="day-of-week">[[day.date]]</span>
          </paper-toolbar>
          <div class="card-content">
            <template is="dom-repeat" items="[[day.lessons]]" as="lesson">
              <div class="layout horizontal lesson">
                <div class="layout vertical center padding-right">
                  <span class="number">[[lesson.number]]</span>
                  <span class="time">[[lesson.time.from]]</span>
                  <span class="time">[[lesson.time.to]]</span>
                </div>
                <div class="flex layout vertical">
                  <div class="layout horizontal justified">
                    <span class="secondary">[[lesson.room]]</span>
                    <span class="secondary">[[lesson.type]]</span>
                  </div>
                  <span class="name">[[lesson.name]]</span>
                  <span class="secondary">[[lesson.note]]</span>
                  <span class="secondary">[[lesson.teacher]]</span>
                  <span class="secondary">[[lesson.group]]</span>
                </div>
              </div>
            </template>
          </div>
        </paper-card>
      </div>
    </template>
  </div>

</template>

<script>
  Polymer({

    is: 'timetable-list',

    properties: {
      items: {
          type: Array,
          value: []
      }
    },

    ready: function () {
      window.localforage.getItem('timetable')
        .then(this.onCachedTimetableLoaded.bind(this));
    },

    onCachedTimetableLoaded: function (items) {
        this.items = items;
        this.loadTimetable();
    },

    loadTimetable: function () {
      var params = {
        criteriaType: 0,
        criterion: 739,
        from: '01.01.2017',
        to: '01.02.2017'
      };
      $.get('https://timetable-api.azurewebsites.net/timetable', params, this.onTimetableLoaded.bind(this));
    },

    onTimetableLoaded: function (response) {
      window.localforage.setItem('timetable', response);
      this.items = response;
    }

  });
</script>

</dom-module>

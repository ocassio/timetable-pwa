<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-iconset-svg/iron-iconset-svg.html">
<link rel="import" href="../bower_components/paper-styles/default-theme.html">
<link rel="import" href="../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../bower_components/paper-menu/paper-menu.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="timetable-app">
  <template>

    <iron-iconset-svg size="24" name="icons">
      <svg><defs>
      <g id="arrow-back"><path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"></path></g>
      <g id="date-range"><path d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z"></path></g>
      <g id="menu"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"></path></g>
      <g id="people"><path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"></path></g>
      </defs></svg>
    </iron-iconset-svg>

    <style>
      :host {
        display: block;
      }
      paper-tabs {
        --paper-tabs-selection-bar-color: var(--accent-color)
      }
      paper-toolbar {
        --paper-toolbar-title: {
          margin-left: 0;
        }
      }
      paper-toolbar a,
      paper-toolbar a:active,
      paper-toolbar a:visited {
        color: var(--dark-theme-text-color);
      }
    </style>

    <app-location route="{{route}}"></app-location>
    <app-route
        route="{{route}}"
        pattern="/:page"
        data="{{routeData}}"
        tail="{{subroute}}"></app-route>

    <paper-header-panel mode="waterfall" main>

     <div class="paper-header">
       <paper-toolbar>
         <a href="/" hidden$="[[isMainPage]]"><paper-icon-button icon="icons:arrow-back"></paper-icon-button></a>
         <span class="title">Расписание</span>
         <a href="/date-range"><paper-icon-button icon="icons:date-range"></paper-icon-button></a>
         <a href="/criteria-list"><paper-icon-button icon="icons:people"></paper-icon-button></a>
       </paper-toolbar>
     </div>

     <iron-pages
         selected="[[page]]"
         attr-for-selected="name"
         fallback-selection="[[mainPage]]">
        <timetable-list name="timetable-list"></timetable-list>
        <date-range name="date-range"></date-range>
        <criteria-list name="criteria-list"></criteria-list>
     </iron-pages>

    </paper-header-panel>

    <iron-media-query query="min-width: 600px" query-matches="{{wideLayout}}"></iron-media-query>

  </template>

  <script>
    Polymer({

      is: 'timetable-app',

      properties: {
        items: {
          type: Array,
          value: ['Расписание', 'Критерии', 'Дата']
        },
        page: {
          type: String,
          reflectToAttribute: true,
          observer: 'pageChanged'
        },
        mainPage: {
          type: String,
          value: 'timetable-list'
        },
        isMainPage: {
          type: Boolean,
          computed: 'calculateIsMainPage(page, mainPage)'
        }
      },

      observers: [
        'routePageChanged(routeData.page)'
      ],

      routePageChanged: function(page) {
        this.page = page || this.mainPage;
      },

      pageChanged: function(page) {
        var resolvedPageUrl = this.resolveUrl('elements/' + page + '.html');
        this.importHref(resolvedPageUrl, null, this.showDefault, true);
      },

      showDefault: function() {
        this.page = this.mainPage;
      },

      calculateIsMainPage: function(page, mainPage) {
        return mainPage == page;
      }

    });
  </script>
</dom-module>
